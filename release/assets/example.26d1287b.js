import"./modulepreload-polyfill.b7f2da20.js";class x{constructor(){this.db=null,this.request=null}connect(t,s){return new Promise((r,o)=>{this.request=window.indexedDB.open(t,s),this.request.onsuccess=n=>{r(n),this.db=this.request.result,this.success(n,"\u6570\u636E\u5E93\u6253\u5F00\u6210\u529F")},this.request.onerror=n=>{o(n),this.error(n,"\u6570\u636E\u5E93\u6253\u5F00\u62A5\u9519")},this.request.onupgradeneeded=n=>{this.db=n.target.result,r(n),this.success(null,"\u6570\u636E\u5E93\u5347\u7EA7\u6210\u529F")}})}upgrad(t){this.db=t.target.result}add(t,s){const r=this.db.transaction([t],"readwrite").objectStore(t).add(s);r.onsuccess=o=>{this.success(o,"\u6570\u636E\u5199\u5165\u6210\u529F")},r.onerror=o=>{this.error(o,"\u6570\u636E\u5199\u5165\u5931\u8D25")}}get(t,s){return new Promise((r,o)=>{const n=this.db.transaction([t]).objectStore(t).get(s);n.onsuccess=()=>{r(n.result),this.success.call(this,n.result)},n.onerror=this.error.call(this,"\u83B7\u53D6\u5931\u8D25")})}update(t,s){const r=this.db.transaction([t],"readwrite").objectStore(t).put(s);r.onsuccess=this.success.call(this,"\u6570\u636E\u66F4\u65B0\u6210\u529F"),r.onerror=this.error.call(this,"\u6570\u636E\u66F4\u65B0\u5931\u8D25")}delete(t,s){const r=this.db.transaction([t],"readwrite").objectStore(t).delete(s);r.onsuccess=this.success.call(this,"\u6570\u636E\u5220\u9664\u6210\u529F"),r.onerror=this.error.call(this,"\u6570\u636E\u5220\u9664\u5931\u8D25")}cursor(t){return new Promise((s,r)=>{if(this.hasObjectStoreNames(t)){const o=this.db.transaction([t]).objectStore(t).openCursor();o.onsuccess=n=>{s(n.target.result),this.success(n,"\u904D\u5386\u8868\u6570\u636E\u6210\u529F")},o.onerror=n=>{r(n),this.error(n,"\u904D\u5386\u8868\u6570\u636E\u5931\u8D25")}}else r("\u8868\u4E0D\u5B58\u5728")})}createIndex(t,s){this.db.transaction([t],"readonly").objectStore(t).index(s)}getIndex(t,s,r){return new Promise((o,n)=>{const E=this.db.transaction([t],"readonly").objectStore(t).index(s).get(r);E.onsuccess=v=>{const B=v.target.result;B?o(B):n(v)},E.onerror=()=>{n(e),this.error.call(this,"\u83B7\u53D6\u7D22\u5F15\u5931\u8D25")}})}hasObjectStoreNames(t){return this.db.objectStoreNames.contains(t)?(this.success(null,`${t} \u8868\u5DF2\u5B58\u5728`),!0):(this.error(null,`${t} \u8868\u4E0D\u5B58\u5728`),!1)}create(t,s,r={keyPath:!1}){if(!this.db.objectStoreNames.contains(t)){let o=null;r.keyPath?o=this.db.createObjectStore(t,{keyPath:r.keyPath}):o=this.db.createObjectStore(t,{autoIncrement:!0}),s.forEach(n=>{o.createIndex(n.name,n.name,{unique:n.unique})})}}success(t,s){console.log(t,s||"success")}error(t,s){console.log(t,s||"error")}}var l=null;window.onload=function(){l=new x,l.connect("database",1).then(d=>{if(l.hasObjectStoreNames("person")){const c=l.db.transaction(["person"]).objectStore("person").getAll();c.onsuccess=function(){const u=c.result,b=I.getElementsByTagName("tbody")[0];u.sort((i,a)=>Number(i.id)-Number(a.id)).forEach(i=>{const{id:a,name:m,age:y,email:f}=i,h=document.createElement("tr"),p=`<td align="center">${a}</td>
                        <td align="center">${m}</td>
                        <td align="center">${y}</td>
                        <td align="center">${f}</td>`;h.innerHTML=p,b.appendChild(h)})}}else{const c=[{name:"id",unique:!1},{name:"name",unique:!1},{name:"age",unique:!1},{name:"email",unique:!0}];l.create("person",c,{keyPath:"id"})}});const g=document.getElementById("id"),t=document.getElementById("name"),s=document.getElementById("age"),r=document.getElementById("email"),o=document.getElementById("search-id"),n=document.getElementById("search-name"),E=document.getElementById("search-age"),v=document.getElementById("search-email"),B=document.getElementById("add"),$=document.getElementById("edit"),k=document.getElementById("delete"),N=document.getElementById("search"),I=document.getElementById("table-tbody");function P(d){const c=[],u=l.db.transaction(["person"]).objectStore("person").openCursor();return new Promise((b,i)=>{u.onsuccess=function(a){var m=a.target.result;if(m){const y=m.value,{id:f,name:h,age:p,email:O}=y,w=Object.keys(d).filter(S=>Boolean(d[S]));w.length>0&&w.every(S=>d[S]===y[S])&&c.push({id:f,name:h,age:p,email:O}),m.continue()}u.readyState==="done"&&b(c)},u.onerror=function(a){i(a)}})}function j(d){const c=l.db.transaction([d]).objectStore(d).getAll();c.onsuccess=function(){const u=c.result,b=I.getElementsByTagName("tbody")[0];b.innerHTML="",u.sort((i,a)=>Number(i.id)-Number(a.id)).forEach(i=>{const{id:a,name:m,age:y,email:f}=i,h=document.createElement("tr"),p=`<td align="center">${a}</td>
                    <td align="center">${m}</td>
                    <td align="center">${y}</td>
                    <td align="center">${f}</td>`;h.innerHTML=p,b.appendChild(h)})}}function q(){g.value="",t.value="",s.value="",r.value=""}function D(){g.value?(l.add("person",{id:g.value,name:t.value,age:s.value,email:r.value}),q(),j("person")):alert("\u8BF7\u8F93\u5165ID")}function T(){g.value?(l.db.transaction([l],"readwrite").objectStore("person").put({id:g.value,name:t.value,age:s.value,email:r.value}),q(),j("person")):alert("\u8BF7\u8F93\u5165ID")}function C(){g.value?(l.db.transaction(["person"],"readwrite").objectStore("person").delete(g.value),q(),j("person")):alert("\u8BF7\u8F93\u5165ID")}B.onclick=D,$.onclick=T,k.onclick=C,N.onclick=function(){const d={id:o.value,name:n.value,age:E.value,email:v.value};Object.keys(d).every(c=>!Boolean(d[c]))?j("person"):P(d).then(c=>{const u=I.getElementsByTagName("tbody")[0];u.innerHTML="",c.forEach(b=>{const{id:i,name:a,age:m,email:y}=b,f=document.createElement("tr"),h=`<td align="center">${i}</td>
                        <td align="center">${a}</td>
                        <td align="center">${m}</td>
                        <td align="center">${y}</td>`;f.innerHTML=h,u.appendChild(f)}),console.log(c)})}};
